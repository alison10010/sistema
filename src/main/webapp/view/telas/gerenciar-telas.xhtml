<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:p="http://primefaces.org/ui"
                template="/view/layout/layout.xhtml">

    <ui:define name="title">Telas</ui:define>

    <ui:define name="content">

        <!-- =============================== -->
        <!--   ESTILOS DO PAINEL    -->
        <!-- =============================== -->
        <style>
		    :root{
		      --bg: #f6f8fb;
		      --card: #ffffff;
		      --border: rgba(15, 23, 42, .10);
		      --text: #0f172a;
		      --muted: #64748b;
		    }
		
		    body{
		      background: radial-gradient(1200px 500px at 20% 0%, rgba(13,110,253,.10), transparent 55%),
		                  radial-gradient(900px 400px at 85% 10%, rgba(220,53,69,.08), transparent 60%),
		                  var(--bg);
		      color: var(--text);
		    }
		
		    .page-shell{
		      min-height: 100vh;
		      display: flex;
		      flex-direction: column;
		    }
		
		    .page-header{
		      padding: 28px 0 10px;
		    }
		
		    .title{
		      font-weight: 800;
		      letter-spacing: -0.02em;
		    }
		
		    .subtitle{
		      color: var(--muted);
		      margin-top: 6px;
		    }
		
		    .tile{
		      background: var(--card);
		      border: 1px solid var(--border);
		      border-radius: 18px;
		      box-shadow: 0 12px 30px rgba(15, 23, 42, .06);
		      padding: 18px;
		      position: relative;
		      overflow: hidden;
		      transition: transform .15s ease, box-shadow .15s ease;
		      height: 100%;
		    }
		
		    .tile:hover{
		      transform: translateY(-2px);
		      box-shadow: 0 16px 40px rgba(15, 23, 42, .10);
		    }
		
		    .tile .chip{
		      display: inline-flex;
		      align-items: center;
		      gap: 8px;
		      padding: 8px 10px;
		      border-radius: 12px;
		      background: rgba(13,110,253,.08);
		      color: #0b5ed7;
		      font-weight: 600;
		      font-size: .9rem;
		    }
		
		    .tile-title{
		      margin: 18px 0 0;
		      font-size: 1.25rem;
		      font-weight: 800;
		      text-align: center;
		    }
		
		    .tile-link{
		      margin-top: 18px;
		      display: flex;
		      gap: 10px;
		      align-items: center;
		      justify-content: center;
		      color: var(--muted);
		      font-size: .95rem;
		      user-select: all;
		      text-align: center;
		      flex-wrap: wrap;
		    }
		
		    .tile-link code{
		      background: rgba(15, 23, 42, .06);
		      border: 1px solid rgba(15, 23, 42, .08);
		      padding: 6px 10px;
		      border-radius: 10px;
		      color: var(--text);
		    }
		
		    .edit-btn{
		      position: absolute;
		      top: 12px;
		      right: 12px;
		      width: 38px;
		      height: 38px;
		      border-radius: 12px;
		      border: 1px solid var(--border);
		      background: #fff;
		      display: inline-flex;
		      align-items: center;
		      justify-content: center;
		      box-shadow: 0 8px 18px rgba(15, 23, 42, .08);
		      transition: transform .12s ease;
		    }
		
		    .edit-btn:hover{
		      transform: scale(1.03);
		    }
		
		    .footer-actions{
		      margin-top: auto;
		      padding: 18px 0 28px;
		      display: flex;
		      justify-content: center;
		    }
		
		    .btn-round{
		      border-radius: 999px;
		      padding: 10px 18px;
		    }
		    
		    body .ui-commandlink:hover, body .ui-link:hover{
				text-decoration: none !important;
			}
			        
		  </style>

        <!-- =============================== -->
        <!--           FORMULARIO            -->
        <!-- =============================== -->

        <h:form id="formPainel">

	    <p:growl id="msgs" showDetail="true" life="6000"/>
	
	    <div class="page-shell">
	        <div class="container">
	
	            <!-- HEADER -->
	            <div class="page-header">
	                <div class="d-flex align-items-center gap-3">
	                    <div class="rounded-4 d-flex align-items-center justify-content-center"
	                         style="width:44px;height:44px;background:rgba(13,110,253,.12);color:#0b5ed7;">
	                        <i class="bi bi-grid-3x3-gap fs-4"></i>
	                    </div>
	                    <div>
	                        <h1 class="title h3 mb-0">Gerenciar telas</h1>
	                        <div class="subtitle">Crie e edite as telas e copie o link para abrir em uma TV/monitor.</div>
	                    </div>
	                </div>
	            </div>
	
	            <!-- GRID -->
	            <div class="row g-4 py-3">
	
	                <!-- CARD ADD NOVA TELA -->
	                <div class="col-12 col-md-6 col-lg-4">
	                    <p:commandLink styleClass="tile d-flex align-items-center justify-content-center"
	                                   style="cursor:pointer;border-style:dashed;"
	                                   actionListener="#{telaController.novaTela}"
	                                   process="@this"
	                                   update=":formDlgTela"
	                                   oncomplete="PF('dlgTela').show();">
	
	                        <div class="text-center">
	                            <div class="rounded-circle d-inline-flex align-items-center justify-content-center mb-3"
	                                 style="width:60px;height:60px;background:rgba(13,110,253,.12);color:#0b5ed7;">
	                                <i class="bi bi-plus-lg fs-3"></i>
	                            </div>
	
	                            <div class="fw-bold fs-5">Adicionar tela</div>
	                            <div class="text-secondary small mt-1">
	                                Criar uma nova tela de chamada
	                            </div>
	                        </div>
	                    </p:commandLink>
	                </div>
	                			       
	                <!-- CARDs -->
	        
	                    <ui:repeat value="#{telaController.telas}" var="t" >
	                        <div class="col-12 col-md-6 col-lg-4">
	                            <div class="tile">
	
	                                <!-- EDIT -->
	                                <p:commandLink styleClass="edit-btn"
	                                               title="Editar"
	                                               actionListener="#{telaController.editarTela(t)}"
	                                               process="@this"
	                                               update=":formDlgTela"
	                                               oncomplete="PF('dlgTela').show();">
	                                    <i class="bi bi-pencil-square"></i>
	                                </p:commandLink>
	
	                                <div class="chip">
									  <i class="bi bi-tv"></i>
									  #{t.ativa ? 'Ativa' : 'Inativa'} • #{t.layout == 1 ? 'Vídeo' : 'Senha'}
									</div>

	
	                                <div class="tile-title">#{t.nome}</div>
	
	                                <div class="tile-link">
	                                    <span>Link:</span>
	                                    <code>/sistema/tela?tela=#{t.codigo}</code>
	
	                                    <button type="button"
										        class="btn btn-sm btn-outline-secondary rounded-pill"
										        onclick="copyText('/sistema/tela?tela=#{t.codigo}', this)">
										    <i class="bi bi-copy"></i> Copiar
										</button>

	                                </div>
	
	                            </div>
	                        </div>
	
	                    </ui:repeat>
	
	            </div>
	
	            <!-- FOOTER ACTION -->
	            <div class="footer-actions">
	                <a href="/sistema/dashboard" class="btn btn-dark btn-round">
	                    <i class="bi bi-arrow-left"></i> Voltar para dashboard
	                </a>
	            </div>
	
	        </div>
	    </div>
	
	</h:form>
	
	<!-- ========================= -->
	<!-- DIALOG ÚNICO (ADD + EDIT) -->
	<!-- ========================= -->
	<h:form id="formDlgTela">
	
	    <p:dialog widgetVar="dlgTela"
	              modal="true"
	              resizable="false"
	              closable="true"
	              width="600"
	              styleClass="rounded-4 shadow">
	
	        <f:facet name="header">
	            <div>
	                <h:outputText value="#{empty telaController.tela.id ? 'Adicionar tela' : 'Editar tela'}"
	                              styleClass="fw-bold"/>
	                <div class="text-secondary small">
	                    Ajuste os dados da tela e salve.
	                </div>
	            </div>
	        </f:facet>
	
	        <!-- ID hidden (para update) -->
	        <h:inputHidden value="#{telaController.tela.id}"/>
	
	        <!-- NOME -->
	        <div class="mb-3">
	            <label class="form-label fw-semibold">Nome</label>
	            <p:inputText value="#{telaController.tela.nome}"
	                         styleClass="form-control"
	                         placeholder="Ex: Recepção"
	                         required="true"
	                         requiredMessage="Informe o nome da tela."/>
	        </div>
	
	        <!-- CÓDIGO -->
	        <div class="mb-3">
	            <label class="form-label fw-semibold">Código (usado na URL)</label>
	            <p:inputText value="#{telaController.tela.codigo}"
	                         styleClass="form-control"
	                         placeholder="Ex: TELA_1"
	                         required="true"
	                         requiredMessage="Informe o código da tela."/>
	            <div class="form-text">
	                Fica assim: <code>/sistema/tela?tela=CODIGO</code>
	            </div>
	        </div>
	
	        <!-- LAYOUT -->
	        <div class="mb-3">
	            <label class="form-label fw-semibold">Layout</label>
	
	            <p:selectOneButton value="#{telaController.tela.layout}" styleClass="w-100">
	                <f:selectItem itemLabel="Senha" itemValue="0"/>
	                <f:selectItem itemLabel="Vídeo" itemValue="1"/>
	                <!-- quando mudar, atualiza a seção do vídeo -->
	                <p:ajax update="secVideo"/>
	            </p:selectOneButton>
	
	            <div class="form-text">
	                <b>Senha</b> mostra o painel de chamadas. <b>Vídeo</b> usa a URL abaixo.
	            </div>
	        </div>
	
	        <!-- URL DO VÍDEO (só aparece se layout==1) -->
	        <h:panelGroup id="secVideo" layout="block">
	            <h:panelGroup rendered="#{telaController.tela.layout == 1}" layout="block">
	                <div class="mb-3">
	                    <label class="form-label fw-semibold">URL do vídeo</label>
	                    <p:inputText value="#{telaController.tela.videoUrl}"
	                                 styleClass="form-control"
	                                 placeholder="Ex: https://exemplo.com/video.mp4 ou link embutível"/>
	                    <div class="form-text">
	                        Dica: alguns sites (ex.: YouTube) bloqueiam iframe. Prefira link “embed” ou mp4.
	                    </div>
	                </div>
	            </h:panelGroup>
	        </h:panelGroup>
	        
	        <div class="mb-3">
			    <label class="form-label fw-semibold">Tema</label>
			
			    <p:selectOneButton value="#{telaController.tela.thema}" styleClass="w-100">
			        <f:selectItem itemLabel="Light" itemValue="LIGHT"/>
			        <f:selectItem itemLabel="Dark" itemValue="DARK"/>
			    </p:selectOneButton>
			
			    <div class="form-text">
			        Define as cores da tela (TV/monitor).
			    </div>
			</div>
				        
	
	        <!-- ATIVA -->
	        <div style="display: flex;">	        	
	        	<p:toggleSwitch value="#{telaController.tela.ativa}" onIcon="pi pi-check" offIcon="pi pi-times"> 
				</p:toggleSwitch>
	            <label class="form-check-label" style="margin-left:12px">Tela ativa</label>
	        </div>
	
	        <!-- Rodapé -->
	        <div class="mt-4 d-flex justify-content-end gap-2">
	            <p:commandButton value="Cancelar"
	                             type="button"
	                             styleClass="btn btn-light rounded-pill"
	                             onclick="PF('dlgTela').hide();"/>
	
	            <p:commandButton value="Salvar"
	                             icon="pi pi-save"
	                             actionListener="#{telaController.salvar}"
	                             process="@form"
	                             update=":formPainel :formPainel:msgs"
	                             oncomplete="if(!args.validationFailed) PF('dlgTela').hide();"
	                             styleClass="btn btn-primary rounded-pill"/>
	        </div>	
	    </p:dialog>
	</h:form>

	
	<!-- Toast (se você já usa Bootstrap toast) -->
	<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1080;">
	    <div id="toastCopy" class="toast align-items-center text-bg-dark border-0" role="alert" aria-live="polite" aria-atomic="true">
	        <div class="d-flex">
	            <div class="toast-body">Link copiado ✅</div>
	            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
	        </div>
	    </div>
	</div>
	
	<script>
    	//<![CDATA[
	    function copyText(text, btn) {
	
	        navigator.clipboard.writeText(text).then(() => {
	
	            // pega o ícone dentro do botão clicado
	            const icon = btn.querySelector("i");
	
	            if (icon) {
	                // troca copy -> check
	                icon.classList.remove("bi-copy");
	                icon.classList.add("bi-check2");
	
	                // opcional: muda cor
	                btn.classList.remove("btn-outline-secondary");
	                btn.classList.add("btn-outline-success");
	            }
	
	            // Toast (se existir)
	            const el = document.getElementById('toastCopy');
	            if (el && window.bootstrap) {
	                const t = new bootstrap.Toast(el);
	                t.show();
	            }
	
	            // volta ao normal após 2 segundos
	            setTimeout(() => {
	                if (icon) {
	                    icon.classList.remove("bi-check2");
	                    icon.classList.add("bi-copy");
	                }
	                btn.classList.remove("btn-outline-success");
	                btn.classList.add("btn-outline-secondary");
	            }, 2000);
	        });
	    }
	    //]]>
	</script>



    </ui:define>
</ui:composition>
